(()=>{"use strict";const t=function(t,e){return function(s){s.target.closest(t)&&e(s)}};document.querySelectorAll("[data-todo-app=menu]").forEach((e=>new class extends class{mapOptions(t,e){let s=Object.assign({},t);return s=Array.isArray(t)?t.map((t=>t)):Object.assign({},t),Object.keys(e).forEach((t=>{"object"!=typeof e[t]||e[t]instanceof Node||e[t]instanceof Function?s[t]=e[t]:s[t]=this.mapOptions(s[t],e[t])})),s}getNamespace(t=""){return this.settings.namespace+t}getNamespaceClass(t){return"."+this.getNamespace(t)}_mapMediaOptions(){this.settings=this.mapOptions(this._defaultSettings,this._customSettings),this.settings.medias&&this.settings.medias.forEach((function(t){window.matchMedia(t.media).matches&&(this.settings=this.mapOptions(this.settings,t.settings))}))}_windowResizeListener(){clearTimeout(this._windowResizeTimeout),this._windowResizeTimeout=setTimeout((function(){this._mapMediaOptions(),this._constructPrivates&&this._constructPrivates()}),this.settings.windowResizeDelay)}}{constructor(e){super(),this.el=e,this.menu=this.el.querySelector("[data-todo-list]"),this.todoList=this.menu,this.itemTemplate=this._getTemplate(),this.menu.addEventListener("itemsReady",this.render.bind(this)),this.filter={},this.todoList.addEventListener("click",t("[data-todo-item-action=remove]",(t=>{this.remove(this._getParentIndex(t.target))}))),this._applyDragEvents(),this.todoList.addEventListener("click",t("[value=checked]",(t=>{this.todos[this._getParentIndex(t.target)].checked=t.target.checked,this.save(),this.render()}))),this.el.addEventListener("click",t("[data-todo-action=clearCompleted]",this.clearCompleted.bind(this))),this.el.addEventListener("click",t("[data-todo-filter]",this._filterListener.bind(this))),this.form=this.el.querySelector("[data-todo-form]"),this.form.addEventListener("submit",this._todoFormListener.bind(this)),this._readItems()}add(t){this.insert(t)}insert(t,e=this.todos.length){this.todos.splice(e,0,t),this.save(),this._createItem(t)}save(){window.localStorage.setItem("todos",JSON.stringify(this.todos))}remove(t){this.todos.splice(t,1),this.save(),this.render()}clearCompleted(){this.todos=this.todos.filter((t=>{if(!t.checked)return t})),this.save(),this.render()}_filterListener(t){let e=t.target.closest("[data-todo-filter]");switch(this.el.querySelectorAll("[data-todo-filter]").forEach((t=>t.classList.remove("active"))),e.classList.add("active"),e.dataset.todoFilter){case"*":delete this.filter.checked;break;case"complete":this.filter.checked=!0;break;case"active":this.filter.checked=!1}this.render()}_todoItemDropListener(t){t.preventDefault();let e=t.target.closest("[data-todo-item-dropzone]");if(e.classList.remove("dragover"),e===this.dragged)return void this.render();t.stopPropagation();let s=this.todos[this._getParentIndex(e)],i=this.todos.splice(this._getParentIndex(this.dragged),1)[0],d=this.todos.indexOf(s);"after"===e.dataset.todoItemDropzone&&(d+=1),this.todos.splice(d,0,i),this.save(),this.render()}_todoFormListener(t){t.preventDefault();let e={checked:!1},s=new FormData(this.form);for(let t of s.entries())e[t[0]]=t[1],s.delete(t[0]);e.task.trim().length&&(this.add(e),this.form.reset())}_applyDragEvents(){this.todoList.addEventListener("mouseover",t("[data-todo-item-action=drag]",(t=>{t.target.closest("[data-todo-item]").draggable=!0}))),this.todoList.addEventListener("mouseout",t("[data-todo-item-action=drag]",(t=>{t.target.closest("[data-todo-item]").draggable=!1}))),this.todoList.addEventListener("dragstart",t("[data-todo-item]",(t=>{this.dragged=t.target.closest("[data-todo-item]");let e=this.dragged.cloneNode(!0),s=document.createElement("div");e.classList.add("clone"),s.appendChild(e),this.dragged.appendChild(s),t.dataTransfer.setData("text/plain",this.dragged.dataset.todoIndex),t.dataTransfer.setDragImage(s,4,4),setTimeout((()=>s.remove()),1),this.dragged.previousElementSibling&&this.dragged.previousElementSibling.classList.add("prev-drop-sibling"),this.dragged.nextElementSibling&&this.dragged.nextElementSibling.classList.add("next-drop-sibling"),this.dragged.classList.add("dragged")}))),this.todoList.addEventListener("dragend",t("[data-todo-item]",(t=>{this.render()}))),this.todoList.addEventListener("dragover",t("[data-todo-item-dropzone]",(t=>{t.preventDefault()}))),this.todoList.addEventListener("dragenter",t("[data-todo-item-dropzone]",(t=>{t.preventDefault();let e=t.target.closest("[data-todo-item]"),s=t.target.closest("[data-todo-item-dropzone]");e!==this.dragged&&(this.menu.querySelectorAll("[data-todo-item]").forEach((t=>t.classList.remove("dragover"))),this.menu.querySelectorAll("[data-todo-item-dropzone]").forEach((t=>t.classList.remove("dragover"))),e.classList.add("dragover"),s.classList.add("dragover"))}))),this.todoList.addEventListener("dragleave",t("[data-todo-item-dropzone]",(t=>{}))),document.addEventListener("drop",t("[data-todo-item-dropzone]",this._todoItemDropListener.bind(this)))}_getTemplate(){if(this.itemTemplate)return this.itemTemplate;let t=this.menu.querySelector("[data-todo-item-template]");return document.importNode(t.content,!0)}_createItem(t,e=this.todos.length-1){if(!this._matchesFilter(t))return;let s=document.importNode(this.itemTemplate,!0);s.querySelectorAll("[data-todo-item-content]").forEach((e=>{let s=e.dataset.todoItemContent;t[s]?e.innerHTML=t[s]:e.remove()})),s.querySelector("input[value=checked]").checked=t.checked,t.checked&&s.firstElementChild.classList.add("checked"),s.firstElementChild.dataset.todoIndex=e,this.todoList.appendChild(s)}_matchesFilter(t){if(0===Object.keys(this.filter).length)return!0;let e=!0;for(let s in this.filter)e=e&&this.filter[s]===t[s];return e}_getParentIndex(t){return parseInt(t.closest("[data-todo-index]").dataset.todoIndex)}_readItems(){let t=window.localStorage.getItem("todos");null!==t&&t.length>2?this._setTodos(JSON.parse(t)):fetch("./data/todos.json").then((t=>t.json())).then(this._setTodos.bind(this))}_setTodos(t){this.todos=t,this.save(),this.menu.dispatchEvent(new CustomEvent("itemsReady",{detail:{TodoMenu:this}}))}render(){this.todoList.innerHTML="";for(let t in this.todos)this._createItem(this.todos[t],t)}}(e))),document.querySelectorAll("[data-mode-switch]").forEach((t=>t.addEventListener("click",(t=>{document.documentElement.classList.toggle("switch-mode")}))))})();